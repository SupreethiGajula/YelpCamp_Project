<% layout('layouts/boilerplate') %>

<head>
    <link rel="stylesheet" href="/stylesheets/index.css">
</head>

<!-- Home hero wrapper -->
<div class="home-hero">

    <!-- Background overlay -->
    <div class="overlay"></div>

    <!-- Map -->
    <div id="map"></div>

    <!-- Page content -->
    <div class="container-fluid content-overlay">
        <h1 class="text-white text-center mb-4">All Campgrounds</h1>

        <div class="text-center mb-4">
            <a href="/campgrounds/new" class="btn btn-primary">
                Add Campground
            </a>
        </div>

        <% for (let campground of campgrounds) { %>
            <div class="card mb-3 campground-card">
                <div class="row g-0">
                    <div class="col-md-4">
                        <% if (campground.images.length) { %>
                            <img
                                class="img-fluid rounded-start h-100 w-100 object-fit-cover"
                                src="<%= campground.images[0].url %>"
                                alt="<%= campground.title %>"
                            >
                        <% } else { %>
                            <img
                                class="img-fluid rounded-start h-100 w-100 object-fit-cover"
                                src="data:image/jpeg;base64,..."
                            >
                        <% } %>
                    </div>

                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title"><%= campground.title %></h5>
                            <h6 class="text-muted"><%= campground.location %></h6>
                            <p class="card-text"><%= campground.description %></p>

                            <a
                                class="btn btn-primary"
                                href="/campgrounds/<%= campground._id %>"
                            >
                                View <%= campground.title %>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        <% } %>
    </div>
</div>

<%- "<script>" %>
const maptilerApiKey = "<%- process.env.MAPTILER_API_KEY %>";
const campgrounds = {
  type: "FeatureCollection",
  features: <%- JSON.stringify(
    campgrounds.map(campground => ({
      type: "Feature",
      geometry: campground.geometry,
      properties: { popUpMarkup: campground?.properties?.popUpMarkup }
    }))
  ) %>
};
<%- "</script>" %>

<script src="/javascripts/clusterMap.js"></script>
